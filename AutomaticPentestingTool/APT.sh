#!/bin/bash
# Autor : Rafael Garcia.

#listas y variables
l_men="Recolectar Explotar Cambiar_Objetivo Salir"
l_rec="TRUE Whatweb TRUE TheHarvester TRUE Wafw00f TRUE Dirb TRUE Dnsenum TRUE Nikto TRUE Nmap"

#fichero de configuracion de las tools
source config.txt


#funciones principales
function pentest(){

	accion=$(yad --form --image Logo_small.png --center --title="APT" --text="Automatic Pentesting Tool" --width=700 --height=300 --field="Objetivo" Objetivo --field="Directorio:DIR")
	bot=$?

	if [ $bot == 0 ]
		then
		obj=$(cut -d'|' -f1 <<< $accion)
		dir=$(cut -d'|' -f2 <<< $accion)
		menu
	else
		salir
	fi

}

function menu(){

	accion=$(yad --list --title="APT" --text="Menu" --image Logo_small.png --center --width=700 --height=300 --separator= --column="Acciones" $l_men)

	case $accion in
		Recolectar)
			gathering
		;;
		Explotar)
			exploit
		;;
		Cambiar_Objetivo)
			pentest
		;;
		Salir)
			salir
		;;
		*)
			pentest
		;;
	esac

}

function gathering(){
	tools_rec=$(yad --image Logo_small.png --center --width=700 --height=300 --list --title="APT" --text="Tools" --checklist --column="check"  --column="tools" $l_rec)

	IFS=$'|' 
 	for tool in $tools_rec;do
		if [ $tool != "TRUE" -a $tool!="\nTRUE" ]
			then
			$tool
		fi
	done
	unset IFS

	menu

}


function exploit(){
	yad --info --text="En desarrollo"
	menu
}

function error(){
	yad --error --text="Se ha producido un error, la aplicación se cerrará"
	exit
}

function salir(){
	yad --image Logo_small.png --center --title="APT"  --width=700 --height=300 --info --text="Hasta pronto" --button="Ok":0
	exit
}


#funciones ejecucion de tools
function Whatweb(){
	ins="whatweb $obj -v $p_whatweb"
	eval $ins
}

function TheHarvester(){
	ins="theharvester -d $obj $p_theharvester"
	eval $ins
}

function Wafw00f(){
	ins="wafw00f -v -a $obj $p_wafw00f"
	eval $ins
}

function Dirb(){
	ins="dirb http://$obj/ $p_dirb"
	eval $ins
}

function Dnsenum(){
	ins="dnsenum $obj $p_dnsenum"
	eval $ins
}

function Nikto(){

	if [ -d $dir ]
	then
		ins="nikto -h $obj $p_nikto -o $dir/nikto.html"
	else
		ins="nikto -h $obj $p_nikto"
	fi

	eval $ins

}

function Nmap(){


	if [ -d $dir ]
	then
		ins="nmap $obj $p_nmap -oA $dir/nmap"
	else
		ins="nmap $obj $p_nmap"
	fi

	eval $ins

}

#inicio programa
pentest
